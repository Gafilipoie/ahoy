(function(a){function b(){if(l=!0,j.fromHash=!1,h){if(0===location.hash.indexOf("#!/")){var b=location.pathname+location.hash.replace(/^#!\//gi,"");history.replaceState({},"",b),j.fromHash=!0}a(window).bind("popstate",g)}else i?a(window).bind("hashchange.router",g):setInterval(function(){location.href!=m&&(g(),m=location.href)},500)}function c(a){var b=a?a:location.pathname;if(b=decodeURI(b),!h)if(0===location.hash.indexOf("#!/"))b+=location.hash.substring(3);else return"";return b=b.replace(/\/$/,""),b}function d(a){for(var b,c=[],d=0,e=k.length;d<e;d++)if(b=k[d],"regexp"==b.type){var f=a.match(b.route);if(f){var g={};g.matches=f,c.push({route:b,data:g}),j.currentId=b.id;break}}else{var h=a.split("/"),l=b.route.split("/");if(l.length==h.length){for(var m,g={},n=0,o=0,p=l.length;o<p;o++)m=0===l[o].indexOf(":"),m?(g[l[o].substring(1)]=decodeURI(h[o]),n++):l[o]==h[o]&&n++;if(l.length==n){c.push({route:b,data:g}),j.currentId=b.id,j.currentParameters=g;break}}}return c}function f(){for(var a=c(location.pathname),b=d(a),e=0,f=b.length;e<f;e++)b[e].route.callback(b[e].data)}function g(a){null!=a&&a.originalEvent&&a.originalEvent.state?f():i?f():!i&&!h&&f()}var h=history&&history.pushState,i=!h&&"onhashchange"in window&&!1,j={},k=[],l=!1,m=location.href;j.currentId="",j.currentParameters={},j.capabilities={hash:i,pushState:h,timer:!i&&!h},j.reset=function(){var a={};a.currentId="",a.currentParameters={}},j.add=function(a,c,d){"function"==typeof c&&(d=c);var e="object"==typeof a;e||(a.lastIndexOf("/")==a.length-1&&(a=a.substring(0,a.length-1)),a=a.replace(location.protocol+"//","").replace(location.hostname,""));var f={route:a,callback:d,type:e?"regexp":"string",id:c};k.push(f),l||b()},b(),j.go=function(a,b){if(h)history.pushState({},b,a),f();else{a=a.replace(location.protocol+"//","").replace(location.hostname,"");var c=a.replace(location.pathname,"");0>c.indexOf("!")&&(c="!/"+c),location.hash=c}},j.check=j.redo=function(){f(!0)},j.parameters=function(a){var b=c(a),e=d(b);return j.currentParameters=0==e.length?{}:e[0].data,j.currentParameters},a.router?window.console&&window.console.warn&&console.warn("jQuery.status already defined. Something is using the same name."):a.router=j})(jQuery);
